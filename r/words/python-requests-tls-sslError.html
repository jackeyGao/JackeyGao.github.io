<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="author"  content="JackeyGao">
    <meta name="description" content="JackeyGao, ä¸€ä¸ªç¨‹åºå‘˜çš„æŠ€æœ¯åˆ†äº«å’Œå¯¹ç”Ÿæ´»çš„ç†è§£.">
    <meta name="keywords"  content="JackeyGao, JackeyGaoçš„æ—¥è®°æœ¬, Python, Django, Vue.js, chinese-poetry">
    <title>requests çš„Certificate did not matché”™è¯¯</title>
    <meta name="google-site-verification" content="xTBu05X0P9OJkoWvQWGdZimRp6nD6uqesWwTJ6v-BoA" />
    <meta name="google-site-verification" content="7Obwo8u7tT_NKgyJiirEB1qRpINEnh9BtyBa1WtiVjU" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon/favicon-16x16.png">
    <link rel="manifest" href="/static/favicon/site.webmanifest">
    <link rel="mask-icon" href="/static/favicon/safari-pinned-tab.svg" color="#286272">
    <link rel="shortcut icon" href="/static/favicon/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="/static/favicon/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" href="/static/global.css">
    <link rel="stylesheet" href="/static/mobile.css">
    

    
<link rel="stylesheet" href="/static/word.css">
<link rel="stylesheet" href="/static/highlight.css">
<link rel="stylesheet" href="/static/3rd/gitalk.css">

<style>
</style>

  </head>

  <body>
    <div id="canvasWrapper">
      <div id="canvas">
        <div id="toTop" onclick="topFunction();">â‡ª</div>

        <div id="mobileNav" class="hidden">
          <div id="avatarWrapper">
            <img class="avatar" src="/static/images/avatar.png">
          </div>
          <div id="menuNav"></div>
        </div>
        <div id="headerWrapper">
            <header>
                <div id="topNavMobile">
                    <nav id="mobileMenuLink" onclick="ToggleMenu()" class="main-nav clear">â˜°</nav>
                  </div>
                <div id="logo">
                  <a href='/'><img class="logo image" src="/static/images/logo.png"></a>
                </div>
                <div id="topNav">
                  <nav id="mainNavigation">
                    <ul>
                      <li>
                        <a href="/">æ–‡ç« </a>
                      </li>
                      <li>
                        <a href="/r/about.html">å…³äº</a>
                      </li>
                      <li>
                        <a href="/r/links.html">é“¾æ¥</a>
                      </li>
                      <li>
                        <a href="#">áƒ¦</a>
                      </li>
                    </ul>
                  </nav>
                  <nav id="secondaryNavigation">
                    <ul>
                      
                      <li>
                        <a href="/r/sets.html#Djangoå°æŠ€å·§">Djangoå°æŠ€å·§</a>
                      </li>
                      
                      <li>
                        <a href="/r/sets.html#ä¸ªäººé¡¹ç›®">ä¸ªäººé¡¹ç›®</a>
                      </li>
                      
                      <li>
                        <a href="/r/sets.html#å¥½ç©çš„Django">å¥½ç©çš„Django</a>
                      </li>
                      
                      <li>
                        <a href="/r/sets.html#æ·«è¯—ä½œå¯¹">æ·«è¯—ä½œå¯¹</a>
                      </li>
                      
                      <li>
                        <a href="/r/sets.html#çJBæ‰¯æ·¡">çJBæ‰¯æ·¡</a>
                      </li>
                      
                      <li>
                        <a href="/r/sets.html#éšç¬”">éšç¬”</a>
                      </li>
                      
                    </ul>
                  </nav>
                </div>

                <div id="avatarWrapper">
                  <img class="avatar" src="/static/images/avatar.png">
                </div>
            </header>
          </div>
        <div id="pageWrapper">
          
<div id="content" class="typo ui container">
    <div id="article">
        <h1 class="bigtitle">requests çš„Certificate did not matché”™è¯¯</h1>
        <p class="post-date">Posted January 22, 2019</p>
        <p><figure class="hassubimage"><div class="image"><img src="/uploads/images/requests-ca-did-not-match.jpeg"></div><figcaption class="img-title">#Security</figcaption></figure></p>

<p>æœ€è¿‘åœ¨ Django åç«¯å¯¹æ¥å…¶ä»–ç³»ç»Ÿæ—¶é‡åˆ°ä¸€ä¸ª SSL çš„é”™è¯¯ï¼Œ æ˜¯ HTTPS åè®®çš„æ¥å£ï¼Œ æˆ‘ä½¿ç”¨çš„æ˜¯ Python çš„ requests åº“ï¼Œ è¿›è¡Œ HTTP æ•°æ®äº¤æ¢. ä»¥ä¸‹æ˜¯é”™è¯¯çš„è¯¦ç»†:</p>
<figcaption id="coded14bb2e38534dafd4f712cb9832c5538" class="code-wrapper">
<div class="highlight"><pre>connection [ERROR] Certificate did not match expected hostname: 10.0.0.6. Certificate: {'crlDistributionPoints': (u'http://crl.comodoca.com/COMODORSADomainValidationSecureServerCA.crl',), 'subjectAltName': (('DNS', '*.example.com'), ('DNS', 'example.com')), 'notBefore': u'Aug  9 00:00:00 2017 GMT', 'caIssuers': (u'http://crt.comodoca.com/COMODORSADomainValidationSecureServerCA.crt',), 'OCSP': (u'http://ocsp.comodoca.com',), 'serialNumber': u'EF82BAF0A699ACFBC0E5E149E34566EB', 'notAfter': 'Aug  8 23:59:59 2020 GMT', 'version': 3L, 'subject': ((('organizationalUnitName', u'Domain Control Validated'),), (('organizationalUnitName', u'EssentialSSL Wildcard'),), (('commonName', u'*.example.com'),)), 'issuer': ((('countryName', u'GB'),), (('stateOrProvinceName', u'Greater Manchester'),), (('localityName', u'Salford'),), (('organizationName', u'COMODO CA Limited'),), (('commonName', u'COMODO RSA Domain Validation Secure Server CA'),))}</pre><figcaption><a href="#coded14bb2e38534dafd4f712cb9832c5538" class="lang-label"><\>text</a></figcaption></div></figcaption>
<h2 id="<q>hostname doesn&#39;t match</q> é”™è¯¯æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ"><q>hostname doesn&#39;t match</q> é”™è¯¯æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ</h2>
<p>å½“ SSL certificate verification å‘ç°æœåŠ¡å™¨å“åº”çš„è®¤è¯å’Œå®ƒè®¤ä¸ºè‡ªå·±è¿æ¥çš„ä¸»æœºåä¸åŒ¹é…æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™æ ·çš„é”™è¯¯ã€‚å¦‚æœä½ ç¡®å®šæœåŠ¡å™¨çš„ SSL è®¾ç½®æ˜¯æ­£ç¡®çš„ï¼ˆä¾‹å¦‚ä½ å¯ä»¥ç”¨æµè§ˆå™¨è®¿é—®é¡µé¢ï¼‰ï¼Œè€Œä¸”ä½ ä½¿ç”¨çš„æ˜¯ Python 2.6 æˆ–è€… 2.7ï¼Œé‚£ä¹ˆä¸€ä¸ªå¯èƒ½çš„è§£é‡Šå°±æ˜¯ä½ éœ€è¦ Server-Name-Indicationã€‚</p>

<p>Server-Name-Indication ç®€ç§° SNIï¼Œæ˜¯ä¸€ä¸ª SSL çš„å®˜æ–¹æ‰©å±•ï¼Œå…¶ä¸­å®¢æˆ·ç«¯ä¼šå‘Šè¯‰æœåŠ¡å™¨å®ƒè¿æ¥äº†å“ªä¸ªä¸»æœºåã€‚å½“æœåŠ¡å™¨ä½¿ç”¨è™šæ‹Ÿä¸»æœºï¼ˆ Virtual Hostingï¼‰æ—¶è¿™ç‚¹å¾ˆé‡è¦ã€‚è¿™æ ·çš„æœåŠ¡å™¨ä¼šæœåŠ¡å¤šä¸ª SSL ç½‘ç«™ï¼Œæ‰€ä»¥å®ƒä»¬éœ€è¦èƒ½å¤Ÿé’ˆå¯¹å®¢æˆ·ç«¯è¿æ¥çš„ä¸»æœºåè¿”å›æ­£ç¡®çš„è¯ä¹¦ã€‚</p>

<p>Python 3 å’Œ Python 2.7.9+ çš„ SSL æ¨¡å—åŒ…å«äº†åŸç”Ÿçš„ SNI æ”¯æŒã€‚</p>
<h2 id="requests ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™ä¸ªé”™è¯¯?">requests ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™ä¸ªé”™è¯¯?</h2>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œ æœåŠ¡å™¨ç«¯ä½¿ç”¨çš„å¯èƒ½æ˜¯ç§æœ‰è¯ä¹¦ï¼Œ æ‰ä¼šå¯¼è‡´è¿™ç§æƒ…å†µã€‚Requests é»˜è®¤é™„å¸¦äº†ä¸€å¥—å®ƒä¿¡ä»»çš„æ ¹è¯ä¹¦ï¼Œæ¥è‡ªäº Mozilla trust storeã€‚ç„¶è€Œå®ƒä»¬åœ¨æ¯æ¬¡ Requests æ›´æ–°æ—¶æ‰ä¼šæ›´æ–°ã€‚è¿™æ„å‘³ç€å¦‚æœä½ å›ºå®šä½¿ç”¨æŸä¸€ç‰ˆæœ¬çš„ Requestsï¼Œä½ çš„è¯ä¹¦æœ‰å¯èƒ½å·²ç» å¤ªæ—§äº†ã€‚ </p>

<p>æ‰€ä»¥å½“ç§æœ‰è¯ä¹¦ï¼Œ æˆ–è€…è¯ä¹¦å¤ªä¹…äº†ï¼Œ éƒ½ä¼šå¯¼è‡´è¯ä¹¦éªŒè¯å¤±è´¥ã€‚</p>

<p>Requests å¯ä»¥ä¸º HTTPS è¯·æ±‚éªŒè¯ SSL è¯ä¹¦ï¼Œå°±åƒ web æµè§ˆå™¨ä¸€æ ·ã€‚SSL éªŒè¯é»˜è®¤æ˜¯å¼€å¯çš„ï¼Œå¦‚æœè¯ä¹¦éªŒè¯å¤±è´¥ï¼ŒRequests ä¼šæŠ›å‡º SSLError:</p>
<figure id="codeea8287a6763aa4da4613426f1aa3b505" class="code-wrapper"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://requestb.in&#39;</span><span class="p">)</span>
<span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">SSLError</span><span class="p">:</span> <span class="n">hostname</span> <span class="s1">&#39;requestb.in&#39;</span> <span class="n">doesn</span><span class="s1">&#39;t match either of &#39;</span><span class="o">*.</span><span class="n">herokuapp</span><span class="o">.</span><span class="n">com</span><span class="s1">&#39;, &#39;</span><span class="n">herokuapp</span><span class="o">.</span><span class="n">com</span><span class="s1">&#39;</span>
</pre></div>
<figcaption><a class="lang-label" href="#codeea8287a6763aa4da4613426f1aa3b505"><\>Python</a></figcaption></figure>
<p>åœ¨è¯¥åŸŸåä¸Šæˆ‘æ²¡æœ‰è®¾ç½® SSLï¼Œæ‰€ä»¥å¤±è´¥äº†ã€‚ä½† Github è®¾ç½®äº† SSL:</p>
<figure id="codee5853585f1bc411b733e6382e131a9c2" class="code-wrapper"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://github.com&#39;</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">Response</span> <span class="p">[</span><span class="mi">200</span><span class="p">]</span><span class="o">&gt;</span>
</pre></div>
<figcaption><a class="lang-label" href="#codee5853585f1bc411b733e6382e131a9c2"><\>Python</a></figcaption></figure><h2 id="æ€ä¹ˆé¿å…ï¼Ÿ">æ€ä¹ˆé¿å…ï¼Ÿ</h2><h3 id="æŒ‡å®š CA è¯ä¹¦æ–¹å¼.">æŒ‡å®š CA è¯ä¹¦æ–¹å¼.</h3>
<p>ä½ å¯ä»¥ä¸º verify ä¼ å…¥ CA_BUNDLE æ–‡ä»¶çš„è·¯å¾„ï¼Œæˆ–è€…åŒ…å«å¯ä¿¡ä»» CA è¯ä¹¦æ–‡ä»¶çš„æ–‡ä»¶å¤¹è·¯å¾„ï¼š</p>
<figure id="codee06f3ed1355a9dcb6e0a082f29fc6644" class="code-wrapper"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://github.com&#39;</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="s1">&#39;/path/to/certfile&#39;</span><span class="p">)</span>
</pre></div>
<figcaption><a class="lang-label" href="#codee06f3ed1355a9dcb6e0a082f29fc6644"><\>Python</a></figcaption></figure>
<p>åœ¨ Session ä¸­å¯ä»¥è®¾ç½®verify å±æ€§.</p>
<figure id="code8ba456b88768c9e3ff0451e7d99c0437" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">verify</span> <span class="o">=</span> <span class="s1">&#39;/path/to/certfile&#39;</span>
</pre></div>
<figcaption><a class="lang-label" href="#code8ba456b88768c9e3ff0451e7d99c0437"><\>Python</a></figcaption></figure><blockquote class="blockquote-warning">
                <p> ä½ è¿˜å¯ä»¥é€šè¿‡ REQUESTS_CA_BUNDLE ç¯å¢ƒå˜é‡å®šä¹‰å¯ä¿¡ä»» CA åˆ—è¡¨ã€‚</p></blockquote><h3 id="å¿½ç•¥å¯¹ SSL è¯ä¹¦çš„éªŒè¯">å¿½ç•¥å¯¹ SSL è¯ä¹¦çš„éªŒè¯</h3>
<p>å¦‚æœä½ å°† verify è®¾ç½®ä¸º Falseï¼ŒRequests ä¹Ÿèƒ½å¿½ç•¥å¯¹ SSL è¯ä¹¦çš„éªŒè¯ã€‚</p>
<figcaption id="code198f35a46b44146eb4c86a56d85ae2c6" class="code-wrapper">
<div class="highlight"><pre>>>> requests.get('https://kennethreitz.org', verify=False)
<Response [200]></pre><figcaption><a href="#code198f35a46b44146eb4c86a56d85ae2c6" class="lang-label"><\>text</a></figcaption></div></figcaption>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ verify æ˜¯è®¾ç½®ä¸º True çš„ã€‚é€‰é¡¹ verify ä»…åº”ç”¨äºä¸»æœºè¯ä¹¦ã€‚</p>

<p>å¯¹äºç§æœ‰è¯ä¹¦ï¼Œä½ ä¹Ÿå¯ä»¥ä¼ é€’ä¸€ä¸ª CA_BUNDLE æ–‡ä»¶çš„è·¯å¾„ç»™ verifyã€‚ä½ ä¹Ÿå¯ä»¥è®¾ç½® REQUEST_CA_BUNDLE ç¯å¢ƒå˜é‡ã€‚</p>
<h2 id="å…¶ä»–">å…¶ä»–</h2>
<p>ä» Requests 2.4.0 ç‰ˆä¹‹åï¼Œå¦‚æœç³»ç»Ÿä¸­è£…äº† certifi åŒ…ï¼ŒRequests ä¼šè¯•å›¾ä½¿ç”¨å®ƒé‡Œè¾¹çš„ è¯ä¹¦ã€‚è¿™æ ·ç”¨æˆ·å°±å¯ä»¥åœ¨ä¸ä¿®æ”¹ä»£ç çš„æƒ…å†µä¸‹æ›´æ–°ä»–ä»¬çš„å¯ä¿¡ä»»è¯ä¹¦ã€‚ä¸ºäº†å®‰å…¨èµ·è§ï¼Œæˆ‘ä»¬å»ºè®®ä½ ç»å¸¸æ›´æ–° certifiï¼</p>

        
    </div>

    <hr>
    
    <div class="controls">
      <div id="commentButton" class="trigger-comment" onclick=" gitalk.render('comments');">ğ””</div>
      
    </div>

    <div id="comments"></div>
</div>

        </div>
        <div id="footerWrapper">
        </div>
      </div>
    </div>
  </body>
  <script src="/static/3rd/darkmode-js.min.js"></script>
  <script>
  window.menu = 'â˜°'
  window.qd = {}
  location.search.substr(1).split("&").forEach(function(item) {window.qd[item.split("=")[0]] = item.split("=")[1]})

  function ToggleMenu () {
    var mobile = document.getElementById('mobileNav');
    var menu = document.getElementById('menuNav');
    var t = document.getElementById('mobileMenuLink');
    var topNav = document.getElementById('topNav');
  
    if (mobile.className === "visible") {
      mobile.className = 'hidden'
      t.innerHTML = 'â˜°'
      window.menu = 'â˜°'
    } else {
      mobile.className = 'visible'
      menu.innerHTML = topNav.innerHTML;
      t.innerHTML = 'âŒ«'
      window.menu = 'âŒ«'
    }
  }

  function topFunction() {
    document.body.scrollTop = 0;
    document.documentElement.scrollTop = 0;
  }

  function scrollFunction() {
    var t = document.getElementById('mobileMenuLink');
    var toTop = document.getElementById('toTop');
    var m = document.getElementById('mobileNav');
    var scrollTop = m.offsetHeight > 100 ? m.offsetHeight : 800;
    if (document.body.scrollTop > scrollTop || document.documentElement.scrollTop > scrollTop) {
      t.innerHTML = 'â‡ª'
      t.onclick = function() {topFunction()};
      toTop.className = 'visible'
    } else {
      t.innerHTML = window.menu
      t.onclick = function() {ToggleMenu()};
      toTop.className = ''
    }
  }

  window.onscroll = function() {scrollFunction()};
  </script>

  

  
<script src="/static/3rd/gitalk.min.js"></script>
<script>
  const gitalk = new Gitalk({
      clientID: '177af99888a292531873',
      clientSecret: '7c0927c7cdf0d94eed7dad0b238552c10ec6f53c',
      repo: 'JackeyGao.github.io',
      owner: 'jackeyGao',
      admin: ['jackeyGao'],
      id: 'python-requests-tls-sslError',      // Ensure uniqueness and length less than 50
      distractionFreeMode: false,  // Facebook-like distraction free mode
      labels: ['gitment'],
      pagerDirection: "last",
      proxy: "https://jgcors.herokuapp.com/https://github.com/login/oauth/access_token"
  })
  
  if (window.qd.hasOwnProperty('code')) {
      document.getElementById('commentButton').scrollIntoView();
      gitalk.render('comments');
  }
  // gitalk.render('comments')
</script>

</html>
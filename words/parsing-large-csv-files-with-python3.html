<html>
    <head>
        <meta charset="utf-8">
        
    
        <title> ç”¨æˆ·Python3è§£æè¶…å¤§çš„csvæ–‡ä»¶ </title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="/assets/global.css">
        <link rel="stylesheet" href="/assets/semantic/components/button.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/icon.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/list.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/container.min.css">
        <link rel="stylesheet" href="/assets/semantic/components/input.min.css">
        
    <link rel="stylesheet" href="/assets/words.css">
    <link rel="stylesheet" href="/assets/monokai.css">
    <link rel="stylesheet" href="/assets/3rd/gitment.css">
    <link rel="stylesheet" href="/assets/semantic/components/table.min.css">

    </head>
    
    <body>
        <div id="site-wrapper" style="display: none;" class="topwrapper">
            <div class="ui container">
                <h3><span style="color: #fff;">æœ¬ç«™æºç æ‰˜ç®¡äº</span></h3>

                <a href="https://github.com/jackeygao/jackeygao.github.io">jackeyGao <b>/</b> jackeyGao.github.io</a>
            </div>
        </div>
        <div id="donation-wrapper" style="display: none;" class="topwrapper">
            <div class="ui container" style="text-align: center;">
                <div class="description">
                    <i class="teal quote left icon"></i>
                    å¦‚æœè§‰å¾—æˆ‘çš„æ–‡ç« å¯¹æ‚¨æœ‰ç”¨ï¼Œè¯·éšæ„æ‰“èµã€‚æ‚¨çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œ!
                    <i class="teal quote right icon"></i>
                </div>

                <div class="ui buttons">
                    <button onclick="useWechat()" id="wechat" class="ui active secondary icon button">
                        å¾®ä¿¡
                    </button>
                    <button onclick="useAlipay()" id="alipay" class="ui secondary icon button">
                        æ”¯ä»˜å®
                    </button>
                </div>

                <div id="donation-qrcode">
                    <img id="wechat-qrcode-image" src="/assets/images/wechat.png">
                    <img id="alipay-qrcode-image" src="/assets/images/alipay.jpg">
                    <!-- <img id="donation-qrcode-image" src="/assets/images/wechat.png"> -->
                </div>
            </div>
        </div>

        <div id="social-links-wrapper" style="display: none;" class="topwrapper">
            <a href="mailto:gaojunqi@outlook.com">
                <button class="ui mini red circular icon button">
                    <i class="mail icon"></i>
                </button>
            </a>
            <a href="https://github.com/jackeygao">
                <button class="ui mini grey circular github icon button">
                  <i class="github icon"></i>
                </button>
            </a>
            <a href="https://twitter.com/JackeyGaoo">
                <button class="ui mini circular twitter icon button">
                  <i class="twitter icon"></i>
                </button>
            </a>
            <button onclick="toggleWechat()" class="ui mini green circular icon button">
                <i class="wechat icon"></i>
            </button>
            
            <div id="wx" style="display: none;">
                <img src="/assets/images/wx.jpeg" />
            </div>
        </div>

        <div id="search-wrapper" style="display: none;" class="topwrapper">
            <div id="search" class="ui container">
              <input type="search" placeholder="Search with google...">
            </div>
        </div>

        <div style="background-color: #000; height: 5px; width: 100%;"></div>

        <div id="triggers-wrapper">
            <div class="ui black mini buttons">
                <button onclick="toggleById(wrappers, 'site-wrapper')" class="ui secondary icon button">
                    <i class="list layout icon"></i>
                </button>
    
                <button onclick="toggleById(wrappers, 'social-links-wrapper')" class="ui secondary icon button">
                    <i class="linkify icon"></i>
                </button>
                <button onclick="toggleById(wrappers, 'search-wrapper')" class="ui secondary icon button">
                    <i class="search icon"></i>
                </button>
                <button class="ui secondary icon button">
                    ğŸ±
                </button>
                <button onclick="toggleById(wrappers, 'donation-wrapper')" class="ui secondary icon button">
                    <i class="red heart icon"></i>
                </button>
            </div>
        </div> 
    
        <div id="main">
            <div class="me">
                <div class="avatar">
                    <img src="/assets/images/avatar.png">
                </div>
    
                <h2 class="name"><span class="grey text">Jackey Gao</span></h2>

                <span class="sign">äººä¸–ä¸€èº«éœœé›ª, å½’æ¥ä»æ˜¯å°‘å¹´.</span>
            </div>
            
            <div class="menu">
                <div class="ui horizontal bulleted link list">
                    <a href="/" class="item">
                        ä¸»é¡µ
                    </a>
                    <a href="/about.html" class="item">
                        å…³äºæˆ‘
                    </a>
                    <div style="cursor: pointer;" class="item" onclick="toggleById(wrappers, 'social-links-wrapper')">
                        è”ç³»
                    </div>
                </div>
            </div>

            
<div id="content" class="typo ui container">
    <div id="article">
        <h1>ç”¨æˆ·Python3è§£æè¶…å¤§çš„csvæ–‡ä»¶</h1>
        <h4>Posted August 15, 2016</h4>
        <p>æˆ‘åœ¨æ—¥å‰è·å¾—ä¸€ä¸ªä»»åŠ¡ï¼Œä¸ºäº†åšåˆ†æ, ä»ä¸€ä¸ªè¶…å¤§çš„csvæ–‡ä»¶ä¸­è§£æemailåœ°å€å’Œå¯¹åº”çš„æ—¥æœŸæ—¶é—´æˆ³ç„¶åæ’å…¥åˆ°æ•°æ®åº“ä¸­. æˆ‘çŸ¥é“æœ‰å…¶ä»–å·¥å…·å¯ä»¥æ–¹ä¾¿çš„å®Œæˆæˆ‘çš„å·¥ä½œ(æ¯”å¦‚pandas),å¯¹äºæœ¬æ–‡çš„ç›®çš„, æˆ‘åªæ‰“ç®—ç”¨pythonçš„æ–¹å¼æ¥å¤„ç†è¿™äº›æ•°æ®.</p>

<p>è¿™ä¸ªcsvæ–‡ä»¶è¶…è¿‡äº†2G, 200ä¸‡æ¡çš„æ•°æ®. èµ·åˆ, æˆ‘å°è¯•ç”¨excelæ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œ æ¥æŸ¥çœ‹æ•°æ® ã€‚ä¸å¹¸çš„æ˜¯, æˆ‘çš„excelç¨‹åºå¼€å§‹å‡æ­»æœ€åæˆ‘ä¸å¾—ä¸æ€æ‰excelè¿›ç¨‹.</p>

<h2>ä½¿ç”¨Generators</h2>
<blockquote class="blockquote-normal">
                <p>A generator function is mainly a more convenient way of writing an iterator. You donâ€™t have to worry about the iterator protocol (.next, .<strong>iter</strong>, etc.). It just works.â€Šâ€”â€ŠDavid Beazley, <a href="http://www.dabeaz.com/generators/">Generator Tricks for Systems Programmers</a></p></blockquote>
<p>Generators å¯ä»¥è®©ä½ å¾ˆå®¹æ˜“çš„ä»ä¸€ä¸ªå¾ˆå¤§çš„æ•°æ®é›†æƒ°æ€§éå†è·å–å•æ¡æ•°æ®, è€Œä¸æ˜¯å…¨éƒ¨è¯»å…¥å†…å­˜.</p>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_email_data</span><span class="p">(</span><span class="n">csv_fname</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">csv_fname</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;latin-1&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">email_records</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">email_record</span> <span class="ow">in</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">email_records</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">email_record</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;./emailData.csv&quot;</span>
    <span class="n">iter_email</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">get_email_data</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
    <span class="nb">next</span><span class="p">(</span><span class="n">iter_email</span><span class="p">)</span>  <span class="c1"># Skipping the column names</span>

    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">iter_email</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
<p>ä½†è¿™æ ·æŠ¥äº†ä¸€ä¸ªé”™...</p>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="ne">UnicodeDecodeError</span><span class="p">:</span> <span class="s1">&#39;ascii&#39;</span> <span class="n">codec</span> <span class="n">can</span><span class="s1">&#39;t decode byte 0xe8 in position 1: ordinal not in range(128).</span>
</pre></div>
</div>
<h2>å…³äºUnicode</h2>
<blockquote class="blockquote-normal">
                <p>The best practice for handling text is the â€œUnicode sandwichâ€ . This means that bytes should be decoded to str as early as possible on input (e.g., when opening a file for reading). The â€œmeatâ€ of the sandwich is the business logic of your program, where text handling is done exclusively on str objects. You should never be encoding or decoding in the middle of other processing. On output, the str are encoded to bytes as late as possible.â€Šâ€”â€ŠLuciano Ramalho, Fluent Python</p></blockquote>
<p>å› ä¸ºæˆ‘è°ƒè¯•çš„æ—¶å€™æ‰“å°åœ¨windowsç»ˆç«¯ä¸Š, å› ä¸ºwindowsé»˜è®¤ä¸æ”¯æŒunicode, æ‰€ä»¥å‡ºç°äº†æ­¤é”™è¯¯. ç„¶åæˆ‘ä¿®æ”¹äº†<code>get_email_data</code></p>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_email_data</span><span class="p">():</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">csv_fname</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;latin-1&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">email_records</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">email_record</span> <span class="ow">in</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">email_records</span><span class="p">):</span>
            <span class="n">ascii_record</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> 
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">email_record</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">ascii_record</span>
</pre></div>
</div>
<p>æ³¨æ„: <code>erros=&#39;replace&#39;</code> å‚æ•°, è¯¥æ–¹æ¡ˆä¸èƒ½å®Œç¾çš„è§£å†³é—®é¢˜, å½“ç¼–ç ä¸€ä¸ªå­—ç¬¦ä¸²å‡ºç°é—®é¢˜, Python æä¾›äº†ä¸‰ç§æ–¹æ³•:</p>

<ul>
<li>1. strict - æŠ›å‡ºä¸€ä¸ªè‡´å‘½çš„é”™è¯¯</li>
<li>2. ignore - åˆ é™¤è¿™ä¸ªå­—ç¬¦</li>
<li>3. replace - ç”¨?æ›¿æ¢å­—ç¬¦</li>
</ul>

<p>replace è™½ç„¶ä¸ç†æƒ³, ä½†ä»–é€‚åˆæˆ‘çš„éœ€è¦. ä½¿ç”¨å®ƒèƒ½è®©æˆ‘çš„ç¨‹åºå®Œæ•´çš„è·‘è¿‡å», è€Œæ²¡æœ‰unicodeé”™è¯¯. </p>

<h2>æ›´é”¦ä¸Šæ·»èŠ±</h2>

<p>æˆ‘ä¸å¤ªæƒ³ç”¨ç´¢å¼•æ¥è·å–æ•°æ®, å°±åƒä¸‹é¢ä¸€æ ·ï¼Œ ä¸€ç‚¹éƒ½ä¸pythonic</p>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># Example: email_row[0], email_row[1], email_row[2], etc...</span>
</pre></div>
</div>
<p>å½“ç„¶è¿™æ ·æ‰æ˜¯æ›´äººæ€§åŒ–ï¼Œ æˆ‘ä¹Ÿå°†è¦ä¼˜åŒ–æˆè¿™æ ·</p>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="c1"># Example: email_row.date, email_row.from, email_row.to, etc...</span>
</pre></div>
</div>
<p><code>NamedTuples</code> æ­£åˆæˆ‘æ„, è¿™é‡ŒåŒæ ·ä¿®æ”¹<code>get_email_data</code>å‡½æ•° </p>
<div class="code-wrapper"><div class="lang-label">Python</div><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_email_data</span><span class="p">(</span><span class="n">csv_fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A generator for the data in the csv. This is because the csv files can often contain millions of records and shouldn&#39;t be stored in memory all at once.</span>

<span class="sd">    :param csv_fname:</span>
<span class="sd">        filename/location of the csv.</span>

<span class="sd">    :return:</span>
<span class="sd">        yields each row as a namedtuple.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">EmailRecord</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;EmailRecord&#39;</span><span class="p">,</span> <span class="s1">&#39;date size from_addr  to_addr subject excerpt&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">csv_fname</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;latin-1&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">email_records</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">email_record</span> <span class="ow">in</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">email_records</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">email_record</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span> <span class="c1"># a valid row</span>
                <span class="n">ascii_email_record</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">email_record</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">EmailRecord</span><span class="p">(</span><span class="o">*</span><span class="n">ascii_email_record</span><span class="p">)</span>
</pre></div>
</div>
<p>å…³äºNamedTuplesï¼Œ å®ƒå±äºæ ‡å‡†åº“é‡Œé¢çš„, å¯ä»¥è®¿é—®è¿™é‡ŒæŸ¥çœ‹æ–‡æ¡£ <a href="https://docs.python.org/3/library/collections.html#collections.namedtuple">NamedTuples</a></p>

<h2>æ€»ç»“</h2>

<p>æˆ‘ä»¬åªæ˜¯å­¦ä¹ æ€ä¹ˆè®©è‡ªå·±çš„ç”µè„‘ä¸æ­»æœº, ç„¶åå‹å¥½çš„å¤„ç†å¤§çš„æ–‡ä»¶. åŒæ—¶æˆ‘ä»¬è¿˜å­¦ä¹ äº†æ›´åŠ å¤šçš„å®ç”¨çš„æŠ€å·§:</p>

<ul>
<li>Generators</li>
<li>å­—ç¬¦ç¼–ç é—®é¢˜</li>
<li>NamedTuples</li>
</ul>

    </div>
    <div id="donate" style="margin-left: auto; margin-right: auto; width: 32em; text-align: center;"></div>
    <div id="comments">
    </div>
    <div id="footer">
        <a href="/#entrys"><div id="more-words">MORE WORDS</div></a>
    </div>
</div>

        </div>
    </body>
    
    
    <script>
        var wrappers = ["donation-wrapper", "social-links-wrapper", "search-wrapper", "site-wrapper"]

        window.onload = function () {
            useWechat()
        }
    </script>
    <script src="/assets/js/web.js"></script>
    
    <script src="/assets/3rd/gitment.browser.js"></script>
    <script>
    const gitment = new Gitment({
        id: 'parsing-large-csv-files-with-python3', // optional
        owner: 'jackeyGao',
        repo: 'JackeyGao.github.io',
        oauth: {
          client_id: '177af99888a292531873',
          client_secret: '7c0927c7cdf0d94eed7dad0b238552c10ec6f53c',
        },
        // ...
        // For more available options, check out the documentation below
      })

    gitment.render('comments')
    </script>


</html>